# ==============================================================================
# Stack Profile: Nuxt 4 + Supabase
# ==============================================================================
# Questo file definisce tutto cio che e specifico dello stack.
# Il wizard lo legge per generare documentazione, prompt, skill e configurazione.
# Per aggiungere un nuovo stack: copia questo file e adatta i valori.
# ==============================================================================

name: nuxt-supabase
display_name: "Nuxt 4 + Vue 3 + Supabase"
description: "Full-stack con Nuxt 4, Vue 3 Composition API, Pinia, Shadcn-vue, Supabase, TypeScript"

# --- Stack tecnologico ---
stack:
  framework: nuxt4
  framework_version: "4"
  language: typescript
  ui_library: shadcn-vue
  css_framework: tailwindcss
  state_management: pinia
  database: supabase
  orm: none
  auth: supabase-auth
  package_manager: pnpm
  monorepo: true
  monorepo_tool: turborepo

# --- Dev server ---
dev_server:
  command: "pnpm dev --dotenv ../../.env"
  working_dir: "apps/web"
  port: 3000
  health_check_url: "http://localhost:3000"
  startup_timeout_seconds: 30

# --- Smoke test ---
smoke_test:
  default_pages:
    - "/"
  feature_pages:
    contacts: ["/", "/contacts"]
    companies: ["/", "/companies"]
    deals: ["/", "/deals"]
    activities: ["/", "/activities"]
    dashboard: ["/", "/dashboard"]
  error_patterns:
    - "an error has occurred"
    - "is not defined"
    - "Internal Server Error"
    - "Cannot read properties"
    - "TypeError"
    - "ReferenceError"
    - "SyntaxError"
    - "nuxt-error-page"
    - "__nuxt_error"

# --- Modelli per step ---
models:
  pm: opus
  dr_spec: sonnet
  dev: opus
  dr_impl: sonnet
  qa: sonnet
  dev_fix: sonnet

# --- Skill files ---
skills:
  base:
    - component.md
  stack:
    - crud-api.md
    - store.md
    - pages.md
    - zod-schema.md
    - design-system.md
  order: "Zod Schema -> CRUD API -> Pinia Store -> Pages"

# --- MCP servers ---
mcp_servers:
  supabase:
    priority: critical
    description: "Database queries, migrations, auth users management"
    command: npx
    args: ["-y", "@supabase/mcp-server-supabase@latest", "--supabase-url", "env:SUPABASE_URL", "--supabase-service-role-key", "env:SUPABASE_SECRET_KEY"]
  playwright:
    priority: high
    description: "Browser automation per test visivi e screenshot"
    command: npx
    args: ["@anthropic/mcp-playwright@latest"]
  fetch:
    priority: medium
    description: "Web fetch per documentazione e risorse esterne"
    command: npx
    args: ["-y", "@anthropic/mcp-fetch@latest"]

# --- Variabili ambiente ---
env_vars:
  required:
    - name: SUPABASE_URL
      description: "URL del progetto Supabase"
    - name: SUPABASE_PUBLISHABLE_KEY
      description: "Anon/publishable key Supabase"
    - name: SUPABASE_SECRET_KEY
      description: "Service role key Supabase (server-only)"
  optional:
    - name: SUPABASE_ACCESS_TOKEN
      description: "Token CLI per migrazioni"
    - name: RESEND_API_KEY
      description: "API key Resend per invio email"
    - name: NUXT_PUBLIC_APP_URL
      description: "URL pubblica dell'app"
    - name: NUXT_PUBLIC_APP_NAME
      description: "Nome dell'app"

# --- Preflight checks ---
preflight:
  node_version: ">=18"
  package_manager: pnpm
  required_cli:
    - name: claude
      install_hint: "https://docs.anthropic.com/en/docs/claude-code"
  optional_cli:
    - name: supabase
      install_hint: "npm install -g supabase"
  playwright_browsers: true

# --- Convenzioni framework-specifiche ---
# Queste vengono iniettate nel template CONVENTIONS.md
conventions:
  file_structure_order: "script setup -> template -> style"
  api_pattern: "server routes con Supabase JS client"
  state_pattern: "Pinia Composition API (defineStore con setup function)"
  validation: "Zod come single source of truth per types e validazione"
  db_access: "Solo da server routes, MAI dal client"
  component_max_lines: 150
  naming:
    components: "PascalCase (ContactCard.vue)"
    composables: "camelCase con prefisso use (useContactFilters.ts)"
    stores: "camelCase con prefisso use (useContactStore.ts)"
    server_routes: "kebab-case (/api/contacts/[id].get.ts)"
    types: "PascalCase (Contact, CreateContact)"
  imports: "Nuxt auto-importa Vue, router, $fetch. Importa solo cio che Nuxt NON auto-importa."
  styling: "Tailwind utility classes, NO style block se non strettamente necessario, cn() helper per classi condizionali"
  dark_mode: "Classi Tailwind dark:, 3 livelli elevazione in dark mode"
  responsive: "Mobile-first con breakpoints Tailwind (sm:, md:, lg:)"

# --- Pre-kickoff steps ---
pre_kickoff:
  - step: 1
    title: "Crea progetto Supabase"
    description: "Vai su supabase.com, crea un nuovo progetto. Salva URL e chiavi."
    when: "always"
  - step: 2
    title: "Configura provider email (Resend)"
    description: "Vai su resend.com, crea account, verifica dominio, salva API key."
    when: "if_email_needed"
  - step: 3
    title: "Configura DNS (Cloudflare)"
    description: "Configura dominio e DNS su Cloudflare."
    when: "if_custom_domain"
  - step: 4
    title: "Installa Supabase CLI"
    description: "npm install -g supabase && supabase login"
    when: "always"
  - step: 5
    title: "Crea file .env"
    description: "Copia .env.example in .env e compila con le credenziali."
    when: "always"
  - step: 6
    title: "Setup deploy (Vercel)"
    description: "Crea account Vercel, connetti repo GitHub."
    when: "post_phase0"
  - step: 7
    title: "DNS Vercel"
    description: "Aggiungi record DNS per il dominio su Vercel."
    when: "post_phase0"
